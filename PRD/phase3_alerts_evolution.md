# PRD: Kazuha Invest 2.0 - Phase 3: Alerts & Evolution

## TL;DR

- Implement intelligent notification system for critical alerts and a self-correcting feedback loop for prediction calibration.

## Goal

- To provide timely, high-conviction alerts to the user, avoiding notification fatigue.
- To continuously improve the AI's prediction accuracy and reasoning logic through a monthly backtesting and calibration mechanism.

## Constraints

- **Notification Channel**: Initially Telegram Bot API (or Discord Webhook if Telegram is not feasible/preferred).
- **Alert Thresholds**: Risk Score > 90 and Confidence > 95 for immediate push notifications.
- **Feedback Loop Frequency**: Monthly (on the 1st of each month).
- **Backtesting Data**: Utilize `High Confidence` predictions stored in reports or a dedicated log.
- **Prompt Adjustment**: Focus on adjusting weights or parameters within the reasoning prompts, not hardcoding logic.

## Acceptance Criteria

- [x] **Smart Alert System**:
    - [x] `notifier.py` exists and can send Telegram messages.
    - [x] Only alerts with `Risk Score > 90` (Shield Alert) or `Confidence > 95` (Alpha Alert) trigger a push notification.
    - [x] Other alerts are recorded silently in `Reports/Daily_Alpha.md` or dedicated log.
    - [x] Notification message content is concise and actionable (e.g., "ğŸš€ ç™¼ç¾çµæ§‹æ€§æ©Ÿæœƒï¼šCRML (æ ¼é™µè˜­ç¨€åœŸ)ï¼Œå»ºè­°ç«‹å³æŸ¥çœ‹ã€‚", "âš ï¸ æŒå€‰é è­¦ï¼šXYZ å…¬å¸é¢è‡¨åšç©ºæ©Ÿæ§‹å ±å‘Šã€‚").
    - [x] Error handling for notification delivery failures.
- [x] **Self-Correction (Feedback Loop)**:
    - [x] `brain_review.py` exists and runs monthly.
    - [x] `brain_review.py` can access historical `High Confidence` predictions and their corresponding asset performance.
    - [x] `brain_review.py` can evaluate prediction accuracy (e.g., if `High Confidence` Alpha predictions performed well, or `High Confidence` Risk alerts materialized).
    - [x] `brain_review.py` can automatically adjust `prompts/scoring_rubric.md` (or relevant prompt parameters) based on backtesting results to improve future accuracy.
    - [x] Logging of calibration adjustments.

## Verification

- **Smart Alert**:
    - Manually trigger a test alert with varying risk/confidence scores to verify filtering.
    - Check Telegram channel for critical alerts and `Reports/` for silent recordings.
- **Self-Correction**:
    - Simulate monthly run of `brain_review.py` with mock historical data and observe changes in `prompts/scoring_rubric.md`.
    - Manual review of calibration logic and prompt adjustments.

## Notes

- The `Risk Score` and `Confidence` metrics need to be generated by the "Local Brain" (Sisyphus) in Phase 2's `Daily_Alpha.md` reports. If not already present, Phase 2 output might need adjustment.
- `prompts/scoring_rubric.md` needs to be defined as a configurable prompt for Sisyphus.
- The mechanism for `brain_review.py` to "adjust prompt weights" for Sisyphus needs careful design; it likely involves modifying a config file or a specific prompt component that Sisyphus reads.

## Progress

Add entries below this line:

### Phase 3: Initial Implementation Complete - 2026-01-14

- **Summary**: Implemented the foundational components for both Smart Alert System and Self-Correction (Feedback Loop). This includes `notifier.py`, updates to `brain_reasoning.py` for score extraction and alert triggering, `prompts/scoring_rubric.md`, and the `brain_review.py` skeleton.
- **Decisions**:
    - **Notification via Telegram**: Adopted Telegram Bot API for critical alerts.
    - **Score Integration**: Integrated `Confidence` and `Risk Score` into the `Daily_Alpha.md` prompt structure and `brain_reasoning.py`'s parsing logic.
    - **Modular Design**: Separated notification logic into `notifier.py` and review logic into `brain_review.py` for clarity and maintainability.
- **Assumptions**:
    - Telegram Bot Token and Chat ID will be provided via `.env` file.
    - `Daily_Alpha.md` generated by Sisyphus will correctly include `Confidence` and `Risk Score` in the specified format.
    - Backtesting and rubric adjustment logic in `brain_review.py` are placeholders for future, more sophisticated implementation.
- **Risks**:
    - Actual Telegram notification requires correct setup of API keys and chat IDs, which is external to this implementation.
    - The parsing logic for `Daily_Alpha.md` for scores might be brittle if Sisyphus's output format varies.
- **Status**: âœ… Initial implementation of Phase 3 components complete.
- **Next**:
    - Test end-to-end flow with real Telegram credentials.
    - Refine parsing logic for `Daily_Alpha.md` for robustness.
    - Develop more sophisticated backtesting and rubric adjustment logic in `brain_review.py`.
    - Update overall `README.md` to mark Phase 3 as complete.
